<!DOCTYPE html>
<html>
<head>
    <script src="http://code.createjs.com/easeljs-0.7.0.min.js"></script>
    <script type="text/javascript" src="js/background.js"></script>
    <script>
		var KEYCODE_UP = 38;		//usefull keycode
		var KEYCODE_LEFT = 37;		//usefull keycode
		var KEYCODE_RIGHT = 39;		//usefull keycode
        var KEYCODE_DOWN = 40;

        var currentKeyH;
        var currentKeyV;
        var circle;
        var square;
	    var stage;
        var canvas;
        var bg;

	    document.onkeydown = handleKeyDown;
		document.onkeyup = handleKeyUp;

        function init() {

            canvas = document.getElementById("canvas");
            fullWindow(canvas);
            stage = new createjs.Stage("canvas");

            bg = new Background('assets/background.jpg', canvas.width, canvas.height);
            bg.draw(stage);

            createjs.Ticker.addEventListener("tick", tick);
            createjs.Ticker.setFPS(40);
        }

        function fullWindow(canvas) {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
         }


        function handleKeyDown(event){
            if(event.keyCode == KEYCODE_LEFT || event.keyCode == KEYCODE_RIGHT) {
                currentKeyH = event.keyCode;
            }
            else if(event.keyCode == KEYCODE_DOWN || event.keyCode == KEYCODE_UP) {
                currentKeyV= event.keyCode;
            }   
        }

        function handleKeyUp(event){
            if(currentKeyV == event.keyCode) {
                currentKeyV = null;
            }
            if(currentKeyH == event.keyCode) {            
                currentKeyH = null;
            }
        }


        function addCircle(x, y, radius, parent) {
        	var circle = new createjs.Shape();
			circle.graphics.beginFill("red").drawCircle(0, 0, radius);
			circle.x = x;
			circle.y = y;
			parent.addChild(circle);

			return circle;
        }
       
        function addSquare(x, y, length, parent) {
            var square = new createjs.Shape();
            square.graphics.beginFill("blue").drawRect(0, 0, length, length);
            square.x = x;
            square.y = y;
            parent.addChild(square);

            return square;
        }

        function tick(event) {
        	var delta = event.delta;
            moveBackground(delta);
        	stage.update();
        }

        function moveCircleH(delta) {
        	if(circle.x - 50 < stage.canvas.width) {
	        	circle.x += delta/1000 * 20;
        	}
        	else {
        		circle.x = -50;
        	}
        }

        function moveSquare(x,y, delta) {
            if(currentKeyH == KEYCODE_RIGHT
                && square.x + 50 < stage.canvas.width) {
                square.x += delta/1000 * 100;
            }
            else if(currentKeyH == KEYCODE_LEFT
                && square.x > 0){
                square.x -= delta/1000 * 100;
            } 
            if(currentKeyV == KEYCODE_UP
                && square.y > 0) {
                square.y -= delta/1000 * 100;
            }
            else if(currentKeyV == KEYCODE_DOWN
                && square.y + 50 < stage.canvas.height){
                square.y += delta/1000 * 100;
            } 
        }

        function moveBackground(delta)
        {
            var decalX = 0;
            if(currentKeyH == KEYCODE_RIGHT) {
                decalX = -delta/400 * 100;
            }
            else if(currentKeyH == KEYCODE_LEFT){
                decalX = delta/400 * 100;
            }

            bg.move(decalX);
        }
    </script>
</head>
<body onLoad="init();">
    <canvas id="canvas" width="500" height="300" style="top: 0px; left: 0px; position: absolute;">
        Go get a new browser, you cheesy ;)
    </canvas>
</body>
</html>